# Dummy Legends - Realtime Game Implementation

## üéÆ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö

‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡∏° Dummy Legends ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ **Supabase Realtime** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡πÑ‡∏û‡πà Dummy ‡πÅ‡∏ö‡∏ö multiplayer ‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö realtime

## üèóÔ∏è ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏° (Clean Architecture)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Presentation Layer                  ‚îÇ
‚îÇ  - GameLobbyView (‡∏´‡∏ô‡πâ‡∏≤ lobby)                       ‚îÇ
‚îÇ  - GameRoomView (‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°)                       ‚îÇ
‚îÇ  - gameStore (Zustand state management)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Infrastructure Layer                    ‚îÇ
‚îÇ  - gameRepository (Supabase operations)             ‚îÇ
‚îÇ  - Realtime subscriptions                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 Supabase Backend                     ‚îÇ
‚îÇ  - PostgreSQL Database                              ‚îÇ
‚îÇ  - RPC Functions                                    ‚îÇ
‚îÇ  - Realtime Channels                                ‚îÇ
‚îÇ  - Row Level Security (RLS)                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìä Database Schema

### Tables

#### 1. **game_rooms** - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°
- `id` (UUID) - Primary key
- `code` (TEXT) - ‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á 6 ‡∏´‡∏•‡∏±‡∏Å (unique)
- `name` (TEXT) - ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á
- `host_id` (UUID) - ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á (foreign key ‚Üí auth.users)
- `status` (room_status) - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á: waiting, ready, playing, finished
- `mode` (game_mode) - ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏°: casual, ranked, tournament, private
- `settings` (JSONB) - ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á
- `current_player_count` (INTEGER) - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
- `max_player_count` (INTEGER) - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (2-4)
- `spectators` (TEXT[]) - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏ä‡∏°
- `created_at`, `started_at`, `finished_at` (TIMESTAMP)

#### 2. **room_players** - ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á
- `id` (UUID) - Primary key
- `room_id` (UUID) - Foreign key ‚Üí game_rooms
- `user_id` (UUID) - Foreign key ‚Üí auth.users
- `profile_id` (UUID) - Foreign key ‚Üí profiles
- `status` (player_status) - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: waiting, ready, playing, disconnected
- `is_host` (BOOLEAN) - ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- `is_ready` (BOOLEAN) - ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
- `position` (INTEGER) - ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (0-3)
- `joined_at`, `left_at` (TIMESTAMP)

#### 3. **game_states** - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Å‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô
- `id` (UUID) - Primary key
- `room_id` (UUID) - Foreign key ‚Üí game_rooms (unique)
- `deck` (JSONB) - ‡πÑ‡∏û‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏Å‡∏≠‡∏á
- `discard_pile` (JSONB) - ‡πÑ‡∏û‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏¥‡πâ‡∏á
- `current_turn_user_id` (UUID) - ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô
- `turn_start_time` (TIMESTAMP) - ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô
- `round` (INTEGER) - ‡∏£‡∏≠‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
- `player_hands` (JSONB) - ‡πÑ‡∏û‡πà‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
- `player_melds` (JSONB) - ‡πÑ‡∏û‡πà‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß
- `scores` (JSONB) - ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô

#### 4. **game_actions** - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô
- `id` (UUID) - Primary key
- `room_id` (UUID) - Foreign key ‚Üí game_rooms
- `user_id` (UUID) - Foreign key ‚Üí auth.users
- `action_type` (TEXT) - ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô: draw, discard, meld, knock, gin
- `action_data` (JSONB) - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô
- `created_at` (TIMESTAMP)

#### 5. **player_stats** - ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
- `id` (UUID) - Primary key
- `user_id` (UUID) - Foreign key ‚Üí auth.users (unique)
- `profile_id` (UUID) - Foreign key ‚Üí profiles
- `level`, `exp`, `coins`, `rank`, `elo` (INTEGER)
- `games_played`, `games_won`, `games_lost` (INTEGER)
- `win_rate` (DECIMAL)
- `total_score`, `highest_score` (INTEGER)

## üîß RPC Functions

### 1. **create_game_room**
‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å

**Parameters:**
```typescript
{
  p_name: string,
  p_mode: game_mode,
  p_max_players?: number,
  p_bet_amount?: number,
  p_time_limit?: number,
  p_is_private?: boolean,
  p_password?: string,
  p_allow_spectators?: boolean
}
```

**Returns:** Room details (JSON)

### 2. **join_game_room**
‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°

**Parameters:**
```typescript
{
  p_room_id?: UUID,
  p_room_code?: string,
  p_password?: string
}
```

**Returns:** Success status (JSON)

### 3. **leave_game_room**
‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏° (auto reassign host ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏Å)

**Parameters:**
```typescript
{
  p_room_id: UUID
}
```

### 4. **toggle_ready_status**
‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°/‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°

**Parameters:**
```typescript
{
  p_room_id: UUID
}
```

### 5. **start_game**
‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ host)

**Parameters:**
```typescript
{
  p_room_id: UUID
}
```

### 6. **get_available_rooms**
‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà

**Parameters:**
```typescript
{
  p_mode?: game_mode,
  p_limit?: number
}
```

**Returns:** Array of rooms (JSON)

### 7. **get_room_details**
‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô

**Parameters:**
```typescript
{
  p_room_id: UUID
}
```

**Returns:** Room with players (JSON)

## üîê Row Level Security (RLS)

### Game Rooms
- ‚úÖ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏î‡∏π‡∏´‡πâ‡∏≠‡∏á public ‡πÑ‡∏î‡πâ
- ‚úÖ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏î‡∏π‡∏´‡πâ‡∏≠‡∏á private ‡πÑ‡∏î‡πâ
- ‚úÖ Authenticated users ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ
- ‚úÖ Host ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ
- ‚úÖ Host ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ

### Room Players
- ‚úÖ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏î‡∏π‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ
- ‚úÖ Authenticated users ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ
- ‚úÖ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ
- ‚úÖ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ

### Game States
- ‚úÖ ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ
- ‚úÖ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á update ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ

### Player Stats
- ‚úÖ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏î‡πâ
- ‚úÖ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô update ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ

## üì° Realtime Subscriptions

### Room Updates
```typescript
gameRepository.subscribeToRoom(
  roomId,
  (updatedRoom) => {
    // Handle room updates
  },
  (players) => {
    // Handle player updates
  }
);
```

**Subscribed Events:**
- Room status changes (waiting ‚Üí ready ‚Üí playing ‚Üí finished)
- Room settings changes
- Player join/leave events
- Player ready status changes

### Auto-sync Features
- ‚úÖ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á ‚Üí update ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏° ‚Üí sync ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‚úÖ Host ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° ‚Üí ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
- ‚úÖ Reconnect support ‚Üí subscribe ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

## üéØ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (GameStore)

### ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á
```typescript
const { createRoom } = useGameStore();

const room = await createRoom({
  name: "‡∏´‡πâ‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà",
  mode: "casual",
  maxPlayers: 4,
  betAmount: 100,
  timeLimit: 60,
  isPrivate: false,
  allowSpectators: true
});
```

### ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á
```typescript
const { joinRoom } = useGameStore();

// Join by ID
await joinRoom({ roomId: "room-id" });

// Join by code
await joinRoom({ roomCode: "123456" });

// Join private room
await joinRoom({ 
  roomCode: "123456",
  password: "secret"
});
```

### ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°
```typescript
const { toggleReady } = useGameStore();
await toggleReady();
```

### ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (Host)
```typescript
const { startGame } = useGameStore();
await startGame();
```

### ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á
```typescript
const { leaveRoom } = useGameStore();
await leaveRoom();
```

### ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á
```typescript
const { fetchAvailableRooms, availableRooms } = useGameStore();
await fetchAvailableRooms();
```

## üîÑ Lifecycle

```
1. User creates/joins room
   ‚Üì
2. Auto-subscribe to room updates
   ‚Üì
3. Realtime sync for all changes
   ‚Üì
4. Game starts (all players notified)
   ‚Üì
5. Gameplay with realtime updates
   ‚Üì
6. Game ends
   ‚Üì
7. Auto-unsubscribe when leaving
```

## üöÄ Triggers & Auto-functions

### update_room_player_count()
‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å

### create_player_stats_if_not_exists()
‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å

### update_updated_at_column()
‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó timestamp ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

## üì± Frontend Integration

### ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
- ‚úÖ `/game/lobby` - Lobby ‡∏´‡∏•‡∏±‡∏Å
- ‚úÖ `/game/create-room` - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á
- ‚úÖ `/game/room/[roomId]` - ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°

### State Management
- **Zustand Store** - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ state ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- **Realtime Sync** - ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- **Error Handling** - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏ó‡∏∏‡∏Å case
- **Loading States** - ‡πÅ‡∏™‡∏î‡∏á loading state ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°

## ‚ö° Performance

### Optimizations
- **Indexed Queries** - ‡∏™‡∏£‡πâ‡∏≤‡∏á index ‡∏ó‡∏∏‡∏Å foreign key
- **JSONB Fields** - ‡πÉ‡∏ä‡πâ JSONB ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà flexible
- **Efficient Subscriptions** - Subscribe ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
- **Auto Cleanup** - Unsubscribe ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å

## üß™ Testing

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö

1. **Start Supabase Local**
```bash
npm run supabase-start
```

2. **Run Migrations**
```bash
npm run supabase-migrate
```

3. **Start Dev Server**
```bash
npm run dev
```

4. **‡πÄ‡∏õ‡∏¥‡∏î Browser 2 tabs**
- Tab 1: http://localhost:3001/game/lobby
- Tab 2: http://localhost:3001/game/lobby (incognito)

5. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö Realtime**
- Tab 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á
- Tab 2: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á (‡∏î‡∏π‡∏à‡∏≤‡∏Å lobby ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ room code)
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö ready/unready
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö start game
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö leave room

## üîí Security

### Authentication
- ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á login ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á
- ‚úÖ RLS ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï

### Authorization
- ‚úÖ ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ host ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ
- ‚úÖ ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ
- ‚úÖ Password protection ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á private

### Data Validation
- ‚úÖ Validate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà RPC functions
- ‚úÖ Check permissions ‡∏ó‡∏∏‡∏Å operation
- ‚úÖ Prevent duplicate joins

## üìà Next Steps

### Phase 4: Game Logic (‡∏ï‡πà‡∏≠‡πÑ‡∏õ)
- [ ] Card dealing system
- [ ] Turn management
- [ ] Card play validation
- [ ] Meld/Knock/Gin logic
- [ ] Score calculation
- [ ] Win/Loss detection

### Future Features
- [ ] Matchmaking system
- [ ] ELO ranking
- [ ] Tournament system
- [ ] Replay system
- [ ] Achievements
- [ ] In-game chat
- [ ] Emojis & reactions

## üêõ Troubleshooting

### ‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô lobby
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö RLS policies
- ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô private ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö status = 'waiting'

### Realtime ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Supabase local running
- ‡∏î‡∏π browser console ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö errors
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö subscription setup

### Database errors
- ‡∏£‡∏±‡∏ô `npm run supabase-reset` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ reset database
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö migrations ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î apply ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

## üìö Resources

- [Supabase Realtime Documentation](https://supabase.com/docs/guides/realtime)
- [Zustand Documentation](https://zustand.docs.pmnd.rs/)
- [Next.js App Router](https://nextjs.org/docs/app)

---

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢:** Marosdee Uma  
**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** 2025-01-30  
**Project:** Dummy Legends - Multiplayer Card Game
